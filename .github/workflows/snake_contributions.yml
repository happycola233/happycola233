name: Generate Snake Contributions

on:
  # â° å®šæ—¶ä»»åŠ¡ï¼ˆcron ä½¿ç”¨ UTC æ—¶åŒºï¼‰
  # åŒ—äº¬æ—¶é—´æ¯å¤© 00:00 è¿è¡Œ = UTC æ¯å¤© 16:00 è¿è¡Œ
  schedule:
    - cron: "0 16 * * *"

  # âœ… å…è®¸æ‰‹åŠ¨è§¦å‘ï¼ˆActions é¡µé¢ç‚¹ Run workflowï¼‰
  workflow_dispatch:

# ğŸ” ç»™å·¥ä½œæµå†™å…¥ä»“åº“å†…å®¹çš„æƒé™ï¼ˆç”¨äºæ¨é€åˆ°ä¸»åˆ†æ”¯ï¼‰
permissions:
  contents: write

jobs:
  build:
    name: Build Snake SVG
    runs-on: ubuntu-latest

    steps:
      # 1) ğŸ“¥ æ‹‰å–ä»“åº“ä»£ç ï¼ˆä¸ºäº†è®©åç»­æ­¥éª¤åœ¨æ­£ç¡®çš„å·¥ä½œç›®å½•ä¸­æ‰§è¡Œï¼‰
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 2) ğŸ ç”Ÿæˆè´ªåƒè›‡ SVGï¼ˆä»…ç”Ÿæˆ SVGï¼Œé€Ÿåº¦æ›´å¿«ï¼‰
      # è¾“å‡ºåˆ° snake_contributions/ ç›®å½•ä¸‹
      - name: Generate snake SVG
        uses: Platane/snk/svg-only@v3
        with:
          # ä½¿ç”¨å½“å‰ä»“åº“æ‰€æœ‰è€…ä½œä¸ºç”¨æˆ·å
          github_user_name: ${{ github.repository_owner }}
          outputs: |
            snake_contributions/github-contribution-grid-snake.svg
            snake_contributions/github-contribution-grid-snake-dark.svg?palette=github-dark

      # 3) ğŸš€ æäº¤åˆ°ä¸»åˆ†æ”¯ï¼ˆæŠŠ snake_contributions/ ç›®å½•å†…å®¹æ¨ä¸Šå»ï¼‰
      - name: Commit & Push to main
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

          # ç¡®ä¿ç›®å½•å­˜åœ¨ï¼ˆé€šå¸¸ action ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œä½†è¿™é‡Œå…œåº•ä¸€ä¸‹ï¼‰
          mkdir -p snake_contributions

          git add snake_contributions/*.svg

          # æ²¡æœ‰å˜æ›´å°±ä¸æäº¤ï¼Œé¿å…æ¯å¤©åˆ· commit
          if git diff --cached --quiet; then
            echo "No changes to commit."
            exit 0
          fi

          git commit -m "chore: update snake contributions"
          
          # å…ˆæ‹‰å–è¿œç¨‹æœ€æ–°ä»£ç å¹¶å˜åŸºï¼Œè§£å†³ non-fast-forward é—®é¢˜
          git pull --rebase origin main
          
          git push origin main